<div class="p-4 md:p-6 space-y-6">
  <!-- Page Header -->
  <div class="flex items-center justify-between">
    <h1 class="font-display font-bold text-2xl text-text-primary">Credit Score</h1>
    <button 
      class="btn-secondary bg-white border border-cream-300 hover:bg-cream-50 text-text-secondary flex items-center gap-2 px-4 py-2"
      (click)="setActiveTab(activeTab() === 'overview' ? 'history' : 'overview')"
    >
      <lucide-angular [img]="History" class="w-4 h-4"></lucide-angular>
      <span>{{ activeTab() === 'overview' ? 'View History' : 'Back to Overview' }}</span>
    </button>
  </div>

  @if (loading()) {
    <div class="flex items-center justify-center min-h-[60vh]">
      <div class="flex flex-col items-center gap-3">
        <div class="w-8 h-8 border-4 border-hive-200 border-t-hive-500 rounded-full animate-spin"></div>
        <p class="text-text-secondary font-medium">Loading credit profile...</p>
      </div>
    </div>
  } @else {
    <!-- Overview Tab -->
    @if (activeTab() === 'overview' && creditScore(); as score) {
      <div class="space-y-6 animate-slide-up">
        
        <!-- Score Hero -->
        <div class="dashboard-card flex flex-col items-center justify-center text-center py-8">
          <div class="relative w-64 h-32 mb-8 overflow-hidden">
            <svg viewBox="0 0 200 100" class="w-full h-full">
              <!-- Track -->
              <path d="M 20 100 A 80 80 0 0 1 180 100" fill="none" stroke="currentColor" stroke-width="12" class="text-hive-100" stroke-linecap="round" />
              <!-- Progress -->
              <path 
                d="M 20 100 A 80 80 0 0 1 180 100" 
                fill="none" 
                stroke="currentColor" 
                stroke-width="12" 
                class="text-hive-600 transition-all duration-1000 ease-out" 
                stroke-linecap="round"
                [style.stroke-dasharray]="251"
                [style.stroke-dashoffset]="251 - (251 * (score.score - 300) / 600)" 
              />
            </svg>
            <div class="absolute inset-0 flex flex-col items-center justify-end">
              <span class="text-6xl font-display font-bold text-hive-900 tracking-tighter">{{ score.score }}</span>
            </div>
          </div>

          <div class="px-4 py-1.5 rounded-full bg-hive-500 text-white font-bold text-sm tracking-wider uppercase mb-6 shadow-sm">
            {{ score.status }}
          </div>

          <div class="w-full max-w-md space-y-2">
            <div class="flex justify-between text-sm font-medium">
              <span class="text-text-secondary">Progress to {{ score.nextTier.name }}</span>
              <span class="text-honey-600">{{ score.nextTier.targetScore - score.score }} pts to go</span>
            </div>
            <div class="h-3 bg-cream-200 rounded-full overflow-hidden">
              <div 
                class="h-full bg-honey-500 rounded-full shadow-sm transition-all duration-500" 
                [style.width.%]="score.nextTier.progress"
              ></div>
            </div>
          </div>
        </div>

        <!-- Score Factors -->
        <h3 class="font-display font-bold text-lg text-text-primary">Score Factors</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- Payment Consistency -->
          <div class="dashboard-card p-5 hover:shadow-hive transition-shadow duration-300">
            <div class="flex items-center gap-3 mb-3">
              <div class="w-10 h-10 rounded-full bg-hive-50 flex items-center justify-center text-hive-600">
                <lucide-angular [img]="ShieldCheck" class="w-5 h-5"></lucide-angular>
              </div>
              <h4 class="font-bold text-text-primary">Payment Consistency</h4>
            </div>
            <div class="flex items-end justify-between mb-2">
              <span class="text-2xl font-bold text-hive-900">{{ score.breakdown.paymentConsistency.current }}</span>
              <span class="text-sm font-medium text-text-tertiary mb-1">/ {{ score.breakdown.paymentConsistency.max }}</span>
            </div>
            <div class="h-2 bg-cream-100 rounded-full overflow-hidden">
              <div class="h-full bg-hive-500 rounded-full" [style.width.%]="(score.breakdown.paymentConsistency.current / score.breakdown.paymentConsistency.max) * 100"></div>
            </div>
          </div>

          <!-- Time Active -->
          <div class="dashboard-card p-5 hover:shadow-hive transition-shadow duration-300">
            <div class="flex items-center gap-3 mb-3">
              <div class="w-10 h-10 rounded-full bg-hive-50 flex items-center justify-center text-hive-600">
                <lucide-angular [img]="History" class="w-5 h-5"></lucide-angular>
              </div>
              <h4 class="font-bold text-text-primary">Time Active</h4>
            </div>
            <div class="flex items-end justify-between mb-2">
              <span class="text-2xl font-bold text-hive-900">{{ score.breakdown.timeActive.current }}</span>
              <span class="text-sm font-medium text-text-tertiary mb-1">/ {{ score.breakdown.timeActive.max }}</span>
            </div>
            <div class="h-2 bg-cream-100 rounded-full overflow-hidden">
              <div class="h-full bg-hive-500 rounded-full" [style.width.%]="(score.breakdown.timeActive.current / score.breakdown.timeActive.max) * 100"></div>
            </div>
          </div>

          <!-- Circle Participation -->
          <div class="dashboard-card p-5 hover:shadow-hive transition-shadow duration-300">
            <div class="flex items-center gap-3 mb-3">
              <div class="w-10 h-10 rounded-full bg-hive-50 flex items-center justify-center text-hive-600">
                <lucide-angular [img]="TrendingUp" class="w-5 h-5"></lucide-angular>
              </div>
              <h4 class="font-bold text-text-primary">Circle Participation</h4>
            </div>
            <div class="flex items-end justify-between mb-2">
              <span class="text-2xl font-bold text-hive-900">{{ score.breakdown.participation.current }}</span>
              <span class="text-sm font-medium text-text-tertiary mb-1">/ {{ score.breakdown.participation.max }}</span>
            </div>
            <div class="h-2 bg-cream-100 rounded-full overflow-hidden">
              <div class="h-full bg-hive-500 rounded-full" [style.width.%]="(score.breakdown.participation.current / score.breakdown.participation.max) * 100"></div>
            </div>
          </div>

          <!-- Contribution Ratio -->
          <div class="dashboard-card p-5 hover:shadow-hive transition-shadow duration-300">
            <div class="flex items-center gap-3 mb-3">
              <div class="w-10 h-10 rounded-full bg-hive-50 flex items-center justify-center text-hive-600">
                <lucide-angular [img]="BarChart2" class="w-5 h-5"></lucide-angular>
              </div>
              <h4 class="font-bold text-text-primary">Contribution Ratio</h4>
            </div>
            <div class="flex items-end justify-between mb-2">
              <span class="text-2xl font-bold text-hive-900">{{ score.breakdown.contributionRatio.current }}%</span>
              <span class="text-sm font-medium text-text-tertiary mb-1">Target: {{ score.breakdown.contributionRatio.max }}%</span>
            </div>
            <div class="h-2 bg-cream-100 rounded-full overflow-hidden">
              <div class="h-full bg-hive-500 rounded-full" [style.width.%]="score.breakdown.contributionRatio.current"></div>
            </div>
          </div>
        </div>

        <!-- Improvement Tips -->
        <h3 class="font-display font-bold text-lg text-text-primary">How to Improve</h3>
        <div class="dashboard-card p-0 overflow-hidden">
          <div class="divide-y divide-cream-100">
            @for (tip of score.improvementTips; track tip) {
              <div class="flex items-center justify-between p-4 hover:bg-cream-50 transition-colors group cursor-pointer">
                <div class="flex items-center gap-4">
                  <lucide-angular [img]="Circle" class="w-5 h-5 text-text-tertiary group-hover:text-honey-500 transition-colors"></lucide-angular>
                  <span class="font-medium text-text-primary">{{ tip }}</span>
                </div>
                <lucide-angular [img]="ChevronRight" class="w-5 h-5 text-text-tertiary"></lucide-angular>
              </div>
            }
          </div>
        </div>
      </div>
    }

    <!-- History Tab -->
    @if (activeTab() === 'history') {
      <div class="space-y-6 animate-slide-up">
        <div class="dashboard-card p-6">
          <h3 class="font-display font-bold text-lg text-text-primary mb-6">Score History</h3>
          <div class="space-y-0">
            @for (item of creditHistory(); track item.date + item.description; let last = $last) {
              <div class="relative pl-8 pb-8" [class.pb-0]="last">
                <!-- Timeline Line -->
                @if (!last) {
                  <div class="absolute left-[11px] top-3 bottom-0 w-0.5 bg-cream-200"></div>
                }
                <!-- Timeline Dot -->
                <div 
                  class="absolute left-0 top-1.5 w-6 h-6 rounded-full border-4 border-white shadow-sm flex items-center justify-center z-10"
                  [class.bg-success]="item.type === 'positive'"
                  [class.bg-danger]="item.type === 'negative'"
                ></div>
                
                <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-2">
                  <div>
                    <p class="font-bold text-text-primary">{{ item.description }}</p>
                    <p class="text-xs text-text-secondary">{{ formatDate(item.date) }}</p>
                  </div>
                  <span 
                    class="font-display font-bold text-lg"
                    [class.text-success-dark]="item.type === 'positive'"
                    [class.text-danger-dark]="item.type === 'negative'"
                  >
                    {{ item.points > 0 ? '+' : '' }}{{ item.points }} pts
                  </span>
                </div>
              </div>
            }
          </div>
        </div>
      </div>
    }
  }
</div>
