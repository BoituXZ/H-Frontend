<!-- Transact Page Container -->
<div class="min-h-screen bg-cream-100 p-4 pb-24 md:pb-6">
  <!-- Page Header -->
  <div class="mb-6">
    <h1 class="font-display font-bold text-2xl text-text-primary mb-1">
      Transact
    </h1>
    <p class="text-text-secondary text-sm">
      Send, receive, deposit, or withdraw funds.
    </p>
  </div>

  <!-- Main Transaction Card -->
  <div class="dashboard-card">
    
    <!-- Segmented Tab Control (Visible only for Pay/Receive) -->
    <div *ngIf="state.mode === 'pay' || state.mode === 'receive'" class="flex gap-2 mb-6 p-1 bg-cream-200 rounded-xl">
      <button
        type="button"
        (click)="switchMode('pay')"
        [class]="state.mode === 'pay'
          ? 'flex-1 py-3 rounded-lg bg-white shadow-sm font-semibold text-text-primary transition-all'
          : 'flex-1 py-3 rounded-lg text-text-secondary font-medium hover:text-text-primary transition-all'"
      >
        <div class="flex items-center justify-center gap-2">
          <lucide-angular [img]="ArrowRightLeft" class="w-5 h-5"></lucide-angular>
          <span>Pay Someone</span>
        </div>
      </button>
      <button
        type="button"
        (click)="switchMode('receive')"
        [class]="state.mode === 'receive'
          ? 'flex-1 py-3 rounded-lg bg-white shadow-sm font-semibold text-text-primary transition-all'
          : 'flex-1 py-3 rounded-lg text-text-secondary font-medium hover:text-text-primary transition-all'"
      >
        <div class="flex items-center justify-center gap-2">
          <lucide-angular [img]="QrCode" class="w-5 h-5"></lucide-angular>
          <span>Receive (My QR)</span>
        </div>
      </button>
    </div>

    <!-- ==================== MODE: DEPOSIT (ADD MONEY) ==================== -->
    <div *ngIf="state.mode === 'deposit'" class="animate-fade-in">
      <div class="text-center mb-6">
        <h2 class="text-xl font-bold text-text-primary">Add Money to HiveFund</h2>
        <div class="inline-flex items-center gap-2 mt-2 px-3 py-1 bg-hive-50 rounded-full text-hive-600 text-sm font-medium">
          <lucide-angular [img]="Smartphone" class="w-4 h-4"></lucide-angular>
          From: EcoCash Wallet
        </div>
      </div>

      <!-- Amount Input (Green Accent) -->
      <div class="mb-8">
        <label class="block text-sm font-medium text-text-secondary mb-2">
          Amount to Deposit
        </label>
        <div class="relative">
          <span class="absolute left-4 top-1/2 -translate-y-1/2 text-3xl font-bold text-green-600">
            $
          </span>
          <input
            type="number"
            [(ngModel)]="state.amount"
            placeholder="0.00"
            class="input-field text-3xl font-bold text-center pl-12 py-4 text-green-600 focus:ring-green-500 focus:border-green-500"
            [disabled]="state.isLoading"
          />
        </div>
      </div>

      <!-- Action Button -->
      <button
        type="button"
        (click)="triggerPayment()"
        [disabled]="!state.amount || state.amount <= 0 || state.isLoading"
        class="w-full btn-primary py-4 text-lg font-bold disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
      >
        <lucide-angular *ngIf="!state.isLoading" [img]="ArrowDown" class="w-6 h-6"></lucide-angular>
        <span *ngIf="!state.isLoading">Deposit Now</span>
        <span *ngIf="state.isLoading">Processing...</span>
      </button>
      
      <p class="text-center text-xs text-text-tertiary mt-4">
        This will trigger a USSD prompt on your phone ({{ currentUser.phone }}).
      </p>
    </div>

    <!-- ==================== MODE: WITHDRAW (CASH OUT) ==================== -->
    <div *ngIf="state.mode === 'withdraw'" class="animate-fade-in">
      <div class="text-center mb-6">
        <h2 class="text-xl font-bold text-text-primary">Withdraw to EcoCash</h2>
        <div class="inline-flex items-center gap-2 mt-2 px-3 py-1 bg-hive-50 rounded-full text-hive-600 text-sm font-medium">
          <lucide-angular [img]="Smartphone" class="w-4 h-4"></lucide-angular>
          To: EcoCash Wallet
        </div>
      </div>

      <!-- Amount Input (Red Accent) -->
      <div class="mb-8">
        <label class="block text-sm font-medium text-text-secondary mb-2">
          Amount to Withdraw
        </label>
        <div class="relative">
          <span class="absolute left-4 top-1/2 -translate-y-1/2 text-3xl font-bold text-honey-600">
            $
          </span>
          <input
            type="number"
            [(ngModel)]="state.amount"
            placeholder="0.00"
            class="input-field text-3xl font-bold text-center pl-12 py-4 text-honey-600 focus:ring-honey-500 focus:border-honey-500"
            [disabled]="state.isLoading"
          />
        </div>
      </div>

      <!-- Action Button -->
      <button
        type="button"
        (click)="triggerPayment()"
        [disabled]="!state.amount || state.amount <= 0 || state.isLoading"
        class="w-full btn-primary py-4 text-lg font-bold disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
      >
        <lucide-angular *ngIf="!state.isLoading" [img]="Smartphone" class="w-6 h-6"></lucide-angular>
        <span *ngIf="!state.isLoading">Withdraw Funds</span>
        <span *ngIf="state.isLoading">Processing...</span>
      </button>
      
       <p class="text-center text-xs text-text-tertiary mt-4">
        Funds will be transferred instantly to {{ currentUser.phone }}.
      </p>
    </div>

    <!-- ==================== TAB 1: PAY SOMEONE (EXISTING) ==================== -->
    <div *ngIf="state.mode === 'pay'" class="animate-fade-in">
      <!-- Amount Input -->
      <div class="mb-6">
        <label class="block text-sm font-medium text-text-secondary mb-2">
          Amount to Send
        </label>
        <div class="relative">
          <span class="absolute left-4 top-1/2 -translate-y-1/2 text-3xl font-bold text-honey-600">
            $
          </span>
          <input
            type="number"
            [(ngModel)]="state.amount"
            placeholder="0.00"
            class="input-field text-3xl font-bold text-center pl-12 py-4 text-honey-600"
            [disabled]="state.isLoading"
          />
        </div>
      </div>

      <!-- Pay Bill Mode Toggle -->
      <div class="mb-6">
        <label class="flex items-center justify-between p-4 bg-cream-100 rounded-xl cursor-pointer hover:bg-cream-200 transition-colors">
          <div class="flex items-center gap-3">
            <lucide-angular [img]="Building2" class="w-5 h-5 text-hive-600"></lucide-angular>
            <div>
              <div class="font-semibold text-text-primary text-sm">Pay Merchant/Bill</div>
              <div class="text-xs text-text-tertiary">Switch to merchant code input</div>
            </div>
          </div>
          <input
            type="checkbox"
            [(ngModel)]="isPayBillMode"
            (change)="togglePayBillMode()"
            class="w-5 h-5 rounded text-hive-500 focus:ring-hive-400"
          />
        </label>
      </div>

      <!-- Recipient Input -->
      <div class="mb-6">
        <label class="block text-sm font-medium text-text-secondary mb-2">
          {{ isPayBillMode ? 'Merchant Code' : 'Send to (Phone Number)' }}
        </label>
        <div class="relative">
          <lucide-angular
            [img]="isPayBillMode ? Building2 : Contact"
            class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-text-tertiary"
          ></lucide-angular>
          <input
            type="text"
            [(ngModel)]="state.recipient"
            [placeholder]="isPayBillMode ? 'Enter merchant code' : '+263 77 123 4567'"
            class="input-field pl-12"
            [disabled]="state.isLoading"
          />
        </div>
      </div>

      <!-- Payment Action Button -->
      <button
        type="button"
        (click)="triggerPayment()"
        [disabled]="!isPaymentValid() || state.isLoading"
        class="w-full btn-primary py-4 text-lg font-bold disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
      >
        <lucide-angular
          *ngIf="!state.isLoading"
          [img]="Smartphone"
          class="w-6 h-6"
        ></lucide-angular>
        <span *ngIf="!state.isLoading">Pay with EcoCash</span>
        <span *ngIf="state.isLoading" class="flex items-center gap-2">
          <svg class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          Processing...
        </span>
      </button>

      <!-- Trust Footer -->
      <div class="mt-6 flex items-center justify-center gap-2 text-sm text-text-tertiary">
        <lucide-angular [img]="ShieldCheck" class="w-5 h-5 text-hive-500"></lucide-angular>
        <span>Secured by EcoCash</span>
      </div>
    </div>

    <!-- ==================== TAB 2: RECEIVE (MY QR) ==================== -->
    <div *ngIf="state.mode === 'receive'" class="animate-fade-in">
      <!-- QR Code Display -->
      <div class="flex flex-col items-center">
        <!-- QR Code Frame -->
        <div class="border-4 border-hive-100 rounded-xl p-4 bg-white shadow-hive mb-6">
          <img
            [src]="getQrCodeUrl()"
            [alt]="'QR Code for ' + currentUser.phone"
            class="w-64 h-64 object-contain"
          />
        </div>

        <!-- User Details -->
        <div class="text-center mb-6">
          <h2 class="font-display font-bold text-xl text-text-primary mb-1">
            {{ currentUser.name }}
          </h2>
          <p class="text-hive-600 font-semibold text-lg mb-2">
            {{ currentUser.phone }}
          </p>
          <p class="text-text-tertiary text-sm">
            Scan to pay me via HiveFund
          </p>
        </div>

        <!-- Share Button -->
        <button
          type="button"
          (click)="sharePaymentLink()"
          class="w-full py-3 px-6 border-2 border-hive-500 text-hive-600 font-semibold rounded-hive hover:bg-hive-50 active:bg-hive-100 transition-all duration-200 flex items-center justify-center gap-2"
        >
          <lucide-angular [img]="Share2" class="w-5 h-5"></lucide-angular>
          <span>Share Payment Link</span>
        </button>
      </div>
    </div>

    <!-- Powered by EcoCash Badge -->
    <div class="mt-8 bg-hive-50 rounded-lg p-3 flex items-center justify-center gap-2">
      <!-- Simple wallet/phone icon representation -->
      <svg class="w-6 h-6 text-hive-600" fill="currentColor" viewBox="0 0 24 24">
         <path d="M12 2L2 7v10c0 5.5 3.8 10.7 10 12 6.2-1.3 10-6.5 10-12V7l-10-5zm0 18c-4.4 0-8-3.6-8-8s3.6-8 8-8 8 3.6 8 8-3.6 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"/>
      </svg>
      <span class="font-bold text-hive-600">Powered by EcoCash</span>
    </div>
  </div>

  <!-- Info Cards (Visible only on default modes) -->
  <div *ngIf="state.mode === 'pay' || state.mode === 'receive'" class="mt-6 grid grid-cols-1 gap-4">
    <!-- Transaction History Prompt -->
    <div
      (click)="navigateToWallet()"
      class="bg-white rounded-xl p-4 border border-cream-300 shadow-card cursor-pointer hover:border-honey-400 hover:shadow-honey transition-all duration-200"
    >
      <div class="flex items-start gap-3">
        <div class="w-10 h-10 bg-honey-100 rounded-lg flex items-center justify-center flex-shrink-0">
          <lucide-angular [img]="ArrowRightLeft" class="w-5 h-5 text-honey-600"></lucide-angular>
        </div>
        <div class="flex-1">
          <h3 class="font-semibold text-text-primary text-sm mb-1">
            View Transaction History
          </h3>
          <p class="text-text-tertiary text-xs">
            Check your past transactions in the Wallet section
          </p>
        </div>
        <div class="flex items-center">
          <svg class="w-5 h-5 text-text-tertiary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
          </svg>
        </div>
      </div>
    </div>
  </div>
</div>
