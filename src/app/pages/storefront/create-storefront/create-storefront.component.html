<div class="page-wrapper">
  <app-page-header pageTitle="Create Storefront" />

  <!-- Centered Wizard Container -->
  <div class="max-w-2xl mx-auto">
    <!-- Step Indicator -->
    <div class="flex items-center justify-center mb-8">
      <!-- Step 1 -->
      <div class="flex flex-col items-center">
        <div
          class="w-10 h-10 rounded-full flex items-center justify-center font-semibold transition-colors"
          [ngClass]="{
            'bg-honey-500 text-white': currentStep() === 1,
            'bg-hive-500 text-white': currentStep() > 1,
            'bg-cream-200 text-text-tertiary': currentStep() < 1
          }"
        >
          @if (currentStep() > 1) {
            <lucide-icon [name]="Check" class="w-5 h-5"></lucide-icon>
          } @else {
            1
          }
        </div>
        <span class="text-xs mt-1 text-text-secondary">Details</span>
      </div>

      <!-- Line -->
      <div class="w-16 h-0.5 mx-2" [ngClass]="currentStep() > 1 ? 'bg-hive-500' : 'bg-cream-300'"></div>

      <!-- Step 2 -->
      <div class="flex flex-col items-center">
        <div
          class="w-10 h-10 rounded-full flex items-center justify-center font-semibold transition-colors"
          [ngClass]="{
            'bg-honey-500 text-white': currentStep() === 2,
            'bg-hive-500 text-white': currentStep() > 2,
            'bg-cream-200 text-text-tertiary': currentStep() < 2
          }"
        >
          @if (currentStep() > 2) {
            <lucide-icon [name]="Check" class="w-5 h-5"></lucide-icon>
          } @else {
            2
          }
        </div>
        <span class="text-xs mt-1 text-text-secondary">Products</span>
      </div>

      <!-- Line -->
      <div class="w-16 h-0.5 mx-2" [ngClass]="currentStep() > 2 ? 'bg-hive-500' : 'bg-cream-300'"></div>

      <!-- Step 3 -->
      <div class="flex flex-col items-center">
        <div
          class="w-10 h-10 rounded-full flex items-center justify-center font-semibold transition-colors"
          [ngClass]="{
            'bg-honey-500 text-white': currentStep() === 3,
            'bg-cream-200 text-text-tertiary': currentStep() < 3
          }"
        >
          3
        </div>
        <span class="text-xs mt-1 text-text-secondary">Payment</span>
      </div>
    </div>

    <!-- Step Content Card -->
    <div class="dashboard-card">
      <!-- Step 1: Details -->
      @if (currentStep() === 1) {
        <div>
          <h2 class="text-2xl font-display font-bold text-text-primary mb-6">
            Store Details
          </h2>

          <div class="space-y-5">
            <!-- Store Name -->
            <div>
              <label class="block text-sm font-medium text-text-primary mb-2">
                Store Name <span class="text-honey-600">*</span>
              </label>
              <input
                type="text"
                class="input-field"
                [ngModel]="storeName()"
                (ngModelChange)="storeName.set($event)"
                placeholder="e.g., Boitu's Designs"
                required
              />
            </div>

            <!-- Description -->
            <div>
              <label class="block text-sm font-medium text-text-primary mb-2">
                Description <span class="text-honey-600">*</span>
              </label>
              <textarea
                class="input-field"
                rows="4"
                [ngModel]="description()"
                (ngModelChange)="description.set($event)"
                placeholder="Tell customers about your store..."
                required
              ></textarea>
            </div>

            <!-- Logo Upload -->
            <div>
              <label class="block text-sm font-medium text-text-primary mb-2">
                Store Logo
              </label>

              @if (!logoPreview()) {
                <label class="cursor-pointer">
                  <div class="border-2 border-dashed border-cream-300 rounded-lg p-8 text-center hover:border-hive-500 transition-colors">
                    <lucide-icon [name]="Upload" class="w-10 h-10 text-text-tertiary mx-auto mb-2"></lucide-icon>
                    <p class="text-sm text-text-secondary mb-1">Click to upload logo</p>
                    <p class="text-xs text-text-tertiary">PNG, JPG up to 5MB</p>
                  </div>
                  <input
                    type="file"
                    accept="image/*"
                    class="sr-only"
                    (change)="onLogoSelect($event)"
                  />
                </label>
              } @else {
                <div class="relative inline-block">
                  <img
                    [src]="logoPreview()"
                    alt="Logo preview"
                    class="w-32 h-32 object-cover rounded-lg border-2 border-cream-300"
                  />
                  <button
                    type="button"
                    (click)="removeLogo()"
                    class="absolute -top-2 -right-2 w-6 h-6 bg-danger text-white rounded-full flex items-center justify-center hover:bg-danger-dark transition-colors"
                  >
                    <lucide-icon [name]="X" class="w-4 h-4"></lucide-icon>
                  </button>
                </div>
              }
            </div>

            <!-- Store URL Preview -->
            <div>
              <label class="block text-sm font-medium text-text-primary mb-2">
                Your Store URL
              </label>
              <div class="input-field bg-cream-50 text-text-secondary cursor-not-allowed">
                hivefund.zw/store/{{ slug() || 'your-store' }}
              </div>
              <p class="text-xs text-text-tertiary mt-1">
                Generated automatically from your store name
              </p>
            </div>
          </div>

          <!-- Actions -->
          <div class="flex justify-end mt-6">
            <button
              class="btn-primary"
              [disabled]="!canProceedToStep2()"
              (click)="nextStep()"
            >
              Next
            </button>
          </div>
        </div>
      }

      <!-- Step 2: Add Products -->
      @if (currentStep() === 2) {
        <div>
          <h2 class="text-2xl font-display font-bold text-text-primary mb-6">
            Add Products
          </h2>

          <p class="text-text-secondary mb-6">
            Add at least one product to launch your storefront.
          </p>

          <!-- Products List -->
          @if (products().length > 0) {
            <div class="space-y-3 mb-6">
              @for (product of products(); track product.id) {
                <div class="flex items-start justify-between p-4 bg-cream-50 rounded-lg">
                  <div class="flex-1">
                    <h3 class="font-display font-semibold text-text-primary">
                      {{ product.name }}
                    </h3>
                    <p class="text-lg font-bold text-honey-600">
                      ${{ product.price | number: '1.2-2' }}
                    </p>
                    <p class="text-sm text-text-secondary mt-1">
                      {{ product.description }}
                    </p>
                  </div>
                  <button
                    type="button"
                    (click)="removeProduct(product.id)"
                    class="ml-4 p-2 text-text-secondary hover:text-danger transition-colors"
                  >
                    <lucide-icon [name]="X" class="w-5 h-5"></lucide-icon>
                  </button>
                </div>
              }
            </div>
          }

          <!-- Add Product Form -->
          @if (showAddProductForm()) {
            <div class="dashboard-card bg-hive-50 border-2 border-hive-200 mb-6">
              <h3 class="font-display font-semibold text-text-primary mb-4">
                Add New Product
              </h3>

              <div class="space-y-4">
                <div>
                  <label class="block text-sm font-medium text-text-primary mb-2">
                    Product Name <span class="text-honey-600">*</span>
                  </label>
                  <input
                    type="text"
                    class="input-field"
                    [ngModel]="newProductName()"
                    (ngModelChange)="newProductName.set($event)"
                    placeholder="e.g., Logo Design"
                  />
                </div>

                <div>
                  <label class="block text-sm font-medium text-text-primary mb-2">
                    Price ($) <span class="text-honey-600">*</span>
                  </label>
                  <input
                    type="number"
                    class="input-field"
                    [ngModel]="newProductPrice()"
                    (ngModelChange)="newProductPrice.set($event || 0)"
                    placeholder="0.00"
                    min="0"
                    step="0.01"
                  />
                </div>

                <div>
                  <label class="block text-sm font-medium text-text-primary mb-2">
                    Description <span class="text-honey-600">*</span>
                  </label>
                  <textarea
                    class="input-field"
                    rows="3"
                    [ngModel]="newProductDescription()"
                    (ngModelChange)="newProductDescription.set($event)"
                    placeholder="Describe what you're selling..."
                  ></textarea>
                </div>

                <div class="flex gap-3">
                  <button type="button" class="btn-primary flex-1" (click)="addProduct()">
                    Add Product
                  </button>
                  <button
                    type="button"
                    class="btn-outline flex-1"
                    (click)="toggleAddProductForm()"
                  >
                    Cancel
                  </button>
                </div>
              </div>
            </div>
          } @else {
            <button
              type="button"
              class="btn-outline w-full flex items-center justify-center gap-2 mb-6"
              (click)="toggleAddProductForm()"
            >
              <lucide-icon [name]="Plus" class="w-5 h-5"></lucide-icon>
              Add Product
            </button>
          }

          <!-- Actions -->
          <div class="flex justify-between">
            <button type="button" class="btn-outline" (click)="previousStep()">
              Previous
            </button>
            <button
              type="button"
              class="btn-primary"
              [disabled]="!canCreate()"
              (click)="nextStep()"
            >
              Next
            </button>
          </div>
        </div>
      }

      <!-- Step 3: Payment -->
      @if (currentStep() === 3) {
        <div>
          <h2 class="text-2xl font-display font-bold text-text-primary mb-6">
            Payment Setup
          </h2>

          <div class="bg-linear-to-br from-hive-50 to-white border-2 border-hive-100 rounded-xl p-6 mb-6">
            <div class="flex items-start gap-4">
              <div class="w-12 h-12 bg-hive-500 rounded-lg flex items-center justify-center shrink-0">
                <lucide-icon [name]="CreditCard" class="w-6 h-6 text-white"></lucide-icon>
              </div>
              <div class="flex-1">
                <h3 class="font-display font-semibold text-text-primary mb-2">
                  EcoCash Payment Account
                </h3>
                <p class="text-2xl font-display font-bold text-honey-600 mb-3">
                  {{ ecocashAccount }}
                </p>
                <p class="text-sm text-text-secondary">
                  Customers will pay directly to this EcoCash number. You'll receive
                  instant notifications when payments are made.
                </p>
              </div>
            </div>
          </div>

          <div class="bg-cream-50 rounded-lg p-4 mb-6">
            <h4 class="font-semibold text-text-primary mb-2">What happens next?</h4>
            <ul class="space-y-2 text-sm text-text-secondary">
              <li class="flex items-start gap-2">
                <span class="text-honey-600 mt-0.5">✓</span>
                <span>Your storefront will be live at hivefund.zw/store/{{ slug() }}</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="text-honey-600 mt-0.5">✓</span>
                <span>Customers can browse and order your products</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="text-honey-600 mt-0.5">✓</span>
                <span>You'll manage orders from your dashboard</span>
              </li>
            </ul>
          </div>

          <!-- Actions -->
          <div class="flex justify-between">
            <button type="button" class="btn-outline" (click)="previousStep()">
              Previous
            </button>
            <button type="button" class="btn-primary" (click)="createStorefront()">
              Create Storefront
            </button>
          </div>
        </div>
      }
    </div>
  </div>
</div>
