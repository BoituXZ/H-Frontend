<div class="page-wrapper">
  <app-page-header pageTitle="My Bookings" />

  @if (loading()) {
    <div class="flex items-center justify-center min-h-[60vh]">
      <div class="text-center">
        <div class="spinner w-12 h-12 mx-auto mb-4"></div>
        <p class="text-[var(--text-secondary)]">Loading bookings...</p>
      </div>
    </div>
  } @else {
    <!-- Tabs -->
    <div class="tabs-container">
      <button
        class="tab-button"
        [ngClass]="{
          'border-b-2 border-honey-500 text-hive-900 font-semibold': activeTab() === 'customer',
          'text-gray-500': activeTab() !== 'customer'
        }"
        (click)="setActiveTab('customer')"
      >
        As Customer
      </button>
      <button
        class="tab-button"
        [ngClass]="{
          'border-b-2 border-honey-500 text-hive-900 font-semibold': activeTab() === 'provider',
          'text-gray-500': activeTab() !== 'provider'
        }"
        (click)="setActiveTab('provider')"
      >
        As Provider
      </button>
    </div>

    <!-- Customer Tab -->
    @if (activeTab() === 'customer') {
      <div class="bookings-list">
        @if (customerBookings().length === 0) {
          <div class="empty-state">
            <p class="text-gray-500">No bookings found.</p>
          </div>
        } @else {
          @for (booking of customerBookings(); track booking.id) {
            <div class="booking-card card-theme">
              <div class="booking-header">
                <h3 class="booking-title">{{ booking.gigTitle }}</h3>
                @if (booking.status === 'confirmed') {
                  <span class="status-badge badge-success">Confirmed</span>
                } @else if (booking.status === 'pending') {
                  <span class="status-badge badge-warning">Pending</span>
                } @else if (booking.status === 'completed') {
                  <span class="status-badge badge-success">Completed</span>
                } @else {
                  <span class="status-badge badge-danger">Cancelled</span>
                }
              </div>

              <div class="booking-details">
                <p class="booking-info">
                  <span class="info-label">Provider:</span>
                  <span class="info-value">{{ booking.otherPartyName }}</span>
                </p>
                <p class="booking-info">
                  <span class="info-label">Date:</span>
                  <span class="info-value">{{ formatDate(booking.date) }} at {{ formatTime(booking.date) }}</span>
                </p>
                @if (booking.duration) {
                  <p class="booking-info">
                    <span class="info-label">Duration:</span>
                    <span class="info-value">{{ booking.duration }} hour{{ booking.duration !== 1 ? 's' : '' }}</span>
                  </p>
                }
                <p class="booking-info">
                  <span class="info-label">Total:</span>
                  <span class="info-value font-semibold">${{ booking.totalCost.toFixed(2) }}</span>
                </p>
              </div>

              <div class="booking-actions">
                @if (booking.status === 'confirmed') {
                  <button class="btn-primary" (click)="contactProvider(booking.id)">
                    Contact Provider
                  </button>
                } @else if (booking.status === 'pending') {
                  <button class="btn-outline" (click)="cancelRequest(booking.id)">
                    Cancel Request
                  </button>
                }
              </div>
            </div>
          }
        }
      </div>
    }

    <!-- Provider Tab -->
    @if (activeTab() === 'provider') {
      <div class="provider-bookings">
        <!-- Requests Section -->
        <div class="requests-section">
          <h2 class="section-title">Requests</h2>
          @if (getPendingRequests().length === 0) {
            <p class="text-gray-500 text-sm">No pending requests.</p>
          } @else {
            @for (booking of getPendingRequests(); track booking.id) {
              <div class="booking-card card-theme request-card">
                <div class="request-alert">
                  <lucide-icon [name]="AlertCircle" class="w-5 h-5 text-honey-600"></lucide-icon>
                  <span class="request-alert-text">New Booking Request!</span>
                </div>

                <div class="booking-header">
                  <h3 class="booking-title">{{ booking.gigTitle }}</h3>
                  <span class="status-badge badge-warning">Pending</span>
                </div>

                <div class="booking-details">
                  <p class="booking-info">
                    <span class="info-label">Customer:</span>
                    <span class="info-value">{{ booking.otherPartyName }}</span>
                  </p>
                  <p class="booking-info">
                    <span class="info-label">Date:</span>
                    <span class="info-value">{{ formatDate(booking.date) }} at {{ formatTime(booking.date) }}</span>
                  </p>
                  @if (booking.duration) {
                    <p class="booking-info">
                      <span class="info-label">Duration:</span>
                      <span class="info-value">{{ booking.duration }} hour{{ booking.duration !== 1 ? 's' : '' }}</span>
                    </p>
                  }
                  <p class="booking-info">
                    <span class="info-label">Total:</span>
                    <span class="info-value font-semibold">${{ booking.totalCost.toFixed(2) }}</span>
                  </p>
                </div>

                <div class="booking-actions">
                  <button class="btn-outline" (click)="declineRequest(booking.id)">
                    Decline
                  </button>
                  <button class="btn-primary" (click)="acceptRequest(booking.id)">
                    Accept
                  </button>
                </div>
              </div>
            }
          }
        </div>

        <!-- Upcoming Section -->
        <div class="upcoming-section">
          <h2 class="section-title">Upcoming</h2>
          @if (getUpcomingBookings().length === 0) {
            <p class="text-gray-500 text-sm">No upcoming bookings.</p>
          } @else {
            @for (booking of getUpcomingBookings(); track booking.id) {
              <div class="booking-card card-theme">
                <div class="booking-header">
                  <h3 class="booking-title">{{ booking.gigTitle }}</h3>
                  <span class="status-badge badge-success">Confirmed</span>
                </div>

                <div class="booking-details">
                  <p class="booking-info">
                    <span class="info-label">Customer:</span>
                    <span class="info-value">{{ booking.otherPartyName }}</span>
                  </p>
                  <p class="booking-info">
                    <span class="info-label">Date:</span>
                    <span class="info-value">{{ formatDate(booking.date) }} at {{ formatTime(booking.date) }}</span>
                  </p>
                  @if (booking.duration) {
                    <p class="booking-info">
                      <span class="info-label">Duration:</span>
                      <span class="info-value">{{ booking.duration }} hour{{ booking.duration !== 1 ? 's' : '' }}</span>
                    </p>
                  }
                  <p class="booking-info">
                    <span class="info-label">Total:</span>
                    <span class="info-value font-semibold">${{ booking.totalCost.toFixed(2) }}</span>
                  </p>
                </div>

                <div class="booking-actions">
                  <button class="btn-primary" (click)="markComplete(booking.id)">
                    Mark Complete
                  </button>
                </div>
              </div>
            }
          }
        </div>
      </div>
    }
  }
</div>
